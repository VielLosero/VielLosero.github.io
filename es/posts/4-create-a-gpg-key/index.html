<!DOCTYPE html>
<html><head>
<title>Viel Losero - Uso de GPG: Gnu Privacy Guard.</title>
<link rel="stylesheet" href="../../../css/main.css"/>
<link rel="stylesheet" href="../../../css/syntax.css" />
<link href="https://fonts.googleapis.com/css?family=Nunito|Roboto&display=swap" rel="stylesheet">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script><script type="text/javascript" src="https://blockchain.info/Resources/js/pay-now-button.js"></script>
</head>
<body><header class="homepage-header">
<div class="banner">
    <a href="../../../"><img src="../../../images/v.svg" alt="logo" /></a>
	<div>
	<a id="name" href="../../../"><h1>Viel Losero&#39; website</h1></a>
        <nav class="MenuNav"> 
                                                                                                                                     
                                                                                                                                  
                <a class="sidebar-nav-item active" href="../../../es/posts/" title="">Publicaciones</a>
		                                                                                                                  
                <a class="sidebar-nav-item" href="../../../es/contacto/" title="">Contacto</a>
		                                                                                                                  
                <a class="sidebar-nav-item" href="../../../es/acerca/" title="">Acerca</a>
		
        </nav>        
</div>
</div>

</header>
<section>
		<div id=content>
<main>
    <article>
        <header class="article-header">
            <h1> Uso de GPG: Gnu Privacy Guard.</h1>
        </header>
	 <article>
		<div class="post-meta">
		<p id="post-date"> Posted: Oct 18, 2019 - [ 3286 Words ] 
		
		    
		       - [ <a href="../../../en/posts/4-create-a-gpg-key/">en</a> ]
		    
                                                                                                                                                     
		</p>
		</div>
		 <p id="toc">Table of contents <nav id="TableOfContents">
<ul>
<li><a href="#creación-de-las-claves-publica-y-privada">Creación de las claves publica y privada</a></li>
<li><a href="#gestion-de-claves">Gestion de claves</a>
<ul>
<li><a href="#listado-de-claves-públicas">Listado de claves Públicas</a></li>
<li><a href="#listado-de-claves-privadas">Listado de claves Privadas</a></li>
<li><a href="#creación-de-un-archivo-de-clave-publica-blindado">Creación de un archivo de clave publica blindado</a></li>
<li><a href="#publicación-de-nuestra-clave-pública">Publicación de nuestra clave pública</a></li>
<li><a href="#consulta-de-nuestra-clave-publica">Consulta de nuestra clave publica</a></li>
</ul></li>
<li><a href="#asociación-del-correo-electrónico-a-nuestra-clave">Asociación del correo electrónico a nuestra clave</a>
<ul>
<li><a href="#búsqueda-de-clave-sin-uid">Búsqueda de clave sin UID</a></li>
<li><a href="#verificación-del-correo-associado">Verificación del correo associado</a></li>
<li><a href="#búsqueda-de-clave-con-uid">Búsqueda de clave con UID</a></li>
</ul></li>
<li><a href="#trabajando-con-ficheros">Trabajando con ficheros</a>
<ul>
<li><a href="#cifrado-de-archivo">Cifrado de archivo</a></li>
<li><a href="#descifrado-de-archivo">Descifrado de archivo</a></li>
<li><a href="#firmado-de-archivo">Firmado de archivo</a></li>
<li><a href="#comprobación-de-firma">Comprobación de firma</a></li>
</ul></li>
<li><a href="#terceros">Terceros</a>
<ul>
<li><a href="#importación-de-claves-públicas-de-terceros">Importación de claves públicas de terceros</a></li>
<li><a href="#cifrado-de-mensaje-para-otra-persona">Cifrado de mensaje para otra persona</a>
<ul>
<li><a href="#testando-el-descifrado">Testando el descifrado</a></li>
</ul></li>
<li><a href="#firmando-claves-de-terceros">Firmando claves de terceros</a>
<ul>
<li><a href="#listado-de-claves">Listado de claves</a></li>
<li><a href="#firmado-de-la-clave-pública-de-otra-persona">Firmado de la clave pública de otra persona</a></li>
<li><a href="#confianza-en-claves-públicas-de-terceros">Confianza en claves públicas de terceros</a></li>
<li><a href="#firmado-y-cifrado-de-mensaje-usando-el-uid-del-correo">Firmado y cifrado de mensaje usando el UID del correo</a></li>
</ul></li>
</ul></li>
<li><a href="#administración-de-claves">Administración de claves</a>
<ul>
<li><a href="#actualización-y-comprobación-de-claves-de-terceros">Actualización y comprobación de claves de terceros</a></li>
<li><a href="#creación-del-fichero-de-revocación">Creación del fichero de revocación</a></li>
<li><a href="#cifrado-del-certificado-de-revocación">Cifrado del certificado de revocación</a></li>
</ul></li>
</ul>
</nav></p>
		

<h1 id="creación-de-las-claves-publica-y-privada">Creación de las claves publica y privada</h1>

<p>Para crear las claves GPG podemos utilizar <strong>gpg &ndash;generate-key</strong> o <strong>gpg &ndash;full-generate-key</strong> el primer comando nos creará las claves sin preguntarnos otras opciones más que las necesarias. Si queremos un poco mas de control sobre algunas opciones como el tamaño o el periodo de validez usaremos <strong>gpg &ndash;full-generate-key</strong>.</p>

<p>El tamaño de la clave va relacionado con su seguridad pero también con el rendimiento ya que ha de procesar con números mas largos.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --full-generate-key
gpg <span class="o">(</span>GnuPG<span class="o">)</span> <span class="m">2</span>.2.17<span class="p">;</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2019</span> Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

gpg: creado el directorio <span class="s1">&#39;/root/.gnupg&#39;</span>
gpg: caja de claves <span class="s1">&#39;/root/.gnupg/pubring.kbx&#39;</span> creada
Por favor seleccione tipo de clave deseado:
   <span class="o">(</span><span class="m">1</span><span class="o">)</span> RSA y RSA <span class="o">(</span>por defecto<span class="o">)</span>
   <span class="o">(</span><span class="m">2</span><span class="o">)</span> DSA y ElGamal
   <span class="o">(</span><span class="m">3</span><span class="o">)</span> DSA <span class="o">(</span>sólo firmar<span class="o">)</span>
   <span class="o">(</span><span class="m">4</span><span class="o">)</span> RSA <span class="o">(</span>sólo firmar<span class="o">)</span>
Su elección: <span class="m">1</span>
las claves RSA pueden tener entre <span class="m">1024</span> y <span class="m">4096</span> bits de longitud.
¿De qué tamaño quiere la clave? <span class="o">(</span><span class="m">3072</span><span class="o">)</span> <span class="m">4096</span>
El tamaño requerido es de <span class="m">4096</span> bits
Por favor, especifique el período de validez de la clave.
         <span class="nv">0</span> <span class="o">=</span> la clave nunca caduca
      &lt;n&gt;  <span class="o">=</span> la clave caduca en n días
      &lt;n&gt;w <span class="o">=</span> la clave caduca en n semanas
      &lt;n&gt;m <span class="o">=</span> la clave caduca en n meses
      &lt;n&gt;y <span class="o">=</span> la clave caduca en n años
¿Validez de la clave <span class="o">(</span><span class="m">0</span><span class="o">)</span>? <span class="m">0</span>
La clave nunca caduca
¿Es correcto? <span class="o">(</span>s/n<span class="o">)</span> s

GnuPG debe construir un ID de usuario para identificar su clave.

Nombre y apellidos: Viel Losero
Dirección de correo electrónico: viel.losero@gmail.com
Comentario: 
Ha seleccionado este ID de usuario:
    <span class="s2">&#34;Viel Losero &lt;viel.losero@gmail.com&gt;&#34;</span>

¿Cambia <span class="o">(</span>N<span class="o">)</span>ombre, <span class="o">(</span>C<span class="o">)</span>omentario, <span class="o">(</span>D<span class="o">)</span>irección o <span class="o">(</span>V<span class="o">)</span>ale/<span class="o">(</span>S<span class="o">)</span>alir? V
Es necesario generar muchos bytes aleatorios. Es una buena idea realizar
alguna otra tarea <span class="o">(</span>trabajar en otra ventana/consola, mover el ratón, usar
la red y los discos<span class="o">)</span> durante la generación de números primos. Esto da al
generador de números aleatorios mayor oportunidad de recoger suficiente
entropía.
Es necesario generar muchos bytes aleatorios. Es una buena idea realizar
alguna otra tarea <span class="o">(</span>trabajar en otra ventana/consola, mover el ratón, usar
la red y los discos<span class="o">)</span> durante la generación de números primos. Esto da al
generador de números aleatorios mayor oportunidad de recoger suficiente
entropía.
gpg: /root/.gnupg/trustdb.gpg: se ha creado base de datos de confianza
gpg: clave F87816F5B769CD83 marcada como de confianza absoluta
gpg: creado el directorio <span class="s1">&#39;/root/.gnupg/openpgp-revocs.d&#39;</span>
sgpg: certificado de revocación guardado como <span class="s1">&#39;/root/.gnupg/openpgp-revocs.d/141839E8065C95F48E8DC329F87816F5B769CD83.rev&#39;</span>
claves pública y secreta creadas y firmadas.

pub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>SC<span class="o">]</span>
      141839E8065C95F48E8DC329F87816F5B769CD83
uid                      Viel Losero &lt;viel.losero@gmail.com&gt;
sub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>E<span class="o">]</span>

root@kali:~# </code></pre></div>
<h1 id="gestion-de-claves">Gestion de claves</h1>

<p>Listar las claves nos proporciona el UID identificador <strong>Viel Losero viel.losero@gmail.com</strong> y la huella de la clave (ese numero tan largo) <strong>141839E8065C95F48E8DC329F87816F5B769CD83</strong>.</p>

<p>Podemos usar el UID o la huella con los comandos gpg para definir la clave a usar en el firmado, cifrado o verificación.</p>

<h2 id="listado-de-claves-públicas">Listado de claves Públicas</h2>

<p>Podemos ver que solo tenemos nuestra clave pública, mas adelante veremos como importar mas claves publicas de otras personas para enviarles mensajes.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --list-keys
/root/.gnupg/pubring.kbx
------------------------
pub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>SC<span class="o">]</span>
      141839E8065C95F48E8DC329F87816F5B769CD83
uid        <span class="o">[</span>  absoluta <span class="o">]</span> Viel Losero &lt;viel.losero@gmail.com&gt;
sub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>E<span class="o">]</span></code></pre></div>
<h2 id="listado-de-claves-privadas">Listado de claves Privadas</h2>

<p>El ID y la huella de la clave privada es el mismo que el de la clave púbica, evidentemente. Este listado es simplemente una forma de presentar la información de las claves al usuario. Las claves reales y los archivos de configuración están en el directorio oculto .gnupg tal como explica la  <a href="https://gnupg.org/documentation/manuals/gnupg/GPG-Configuration.html#GPG-Configuration">configuración de archivos de gnupg</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --list-secret-keys
/root/.gnupg/pubring.kbx
------------------------
sec   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>SC<span class="o">]</span>
      141839E8065C95F48E8DC329F87816F5B769CD83
uid        <span class="o">[</span>  absoluta <span class="o">]</span> Viel Losero &lt;viel.losero@gmail.com&gt;
ssb   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>E<span class="o">]</span></code></pre></div>
<h2 id="creación-de-un-archivo-de-clave-publica-blindado">Creación de un archivo de clave publica blindado</h2>

<p>Si queremos enviar nuestra clave pública a otra persona podemos exportar la clave y añadir la opción <strong>armor</strong> para poder ver la información de manera legible (Human Readable), esto simplemente hace que se pase a base64 el archivo binario de la clave pública para poder verlo bien en pantalla. Si intentáramos ver un archivo binario en pantalla sin ningun editor hexadecimal solo veríamos caracteres raros.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --armor --output viel.losero@gmail.com-public-key.gpg --export viel.losero@gmail.com                                                         
root@kali:~# cat viel.losero@gmail.com-public-key.gpg                                                                                                         
-----BEGIN PGP PUBLIC KEY BLOCK-----                                                                                                                          
                                                                                                                                                              
mQINBF2od4EBEAC09q3FqknBkwLYBGFyFjAapNDIb3XD7b4jJNtq8HePz/8oLR6P                                                                                              
jd1Zt+7t3GW888sQqkxbGvmtgx6PwwjBr1fqI+vfbv7LtTqNMHwdkF+2jvR8FjzZ                                                                                              
tkNw8+5ShZeD/gxypaSenIazwQAe0M40VuHQMjZkK7e+wbehR6CZ7Sgf8WYFqxn/                                                                                              
EB7Kfb4bNok7raXo2PZctQQ8iZVaWU1eXYK8wfm9UlTcDeUwe3rlfUenUn29juX7                                                                                              
pfIDCQnnOAnYPvbegIQUPLJ6BG7rpagSOml48MbPvxQ3uOfJ8edWKY5+rvO92jVM                                                                                              
pdZTKqzV5OlCEsPGX4jH/1zzgXWTjvROQSxYw1E9Z+nNEGej6sscMRtGVwOV5TGo                                                                                              
TsRzUdI+0CBaRDW+hoX+7qqzbcCShwX9KaxpgSac1VfP1EKoou4MQQXv4/NVN/JC                                                                                              
eB5mjv27qtkxXDO8EAFd+lUTOeGI303XoZcC+UAUV/WiVrhuwDzJ1M+UutdnR8VB                                                                                              
P/ecrhqhwvQUFuK5zWH2tkxFO/lL2c2Q0+kcbzElhLo/BoP8jjKea2zQAMDVJFv/                                                                                              
Te6zb5KHK9tOUbFxPekhbD2tEDsz4U4P7jmFQAD1wNilljRD2C/Lp4Ft34grx/K2                                                                                              
tpgwpb3NVXvzOmfeWpfO5lKvm9CGP4LR00n3nMdaITHF9XkWuJ9xL3CDmQARAQAB                                                                                              
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<span class="o">=</span>
<span class="o">=</span>Aa5W
-----END PGP PUBLIC KEY BLOCK-----
root@kali:~# </code></pre></div>
<p>Podemos hacer la prueba con los siguientes comandos para obtener la clave pública en binario y luego pasarla a base64.</p>

<ul>
<li><p>gpg &ndash;output file.gpg &ndash;export ID</p></li>

<li><p>cat file.gpg</p></li>

<li><p>cat file.gpg | base64</p></li>
</ul>

<h2 id="publicación-de-nuestra-clave-pública">Publicación de nuestra clave pública</h2>

<p>La publicación de nuestra clave pública sirve para que otras personas nos puedan enviar mensajes cifrados con dicha clave pública y solo nosotros podamos descifrar el mensaje con nuestra clave privada. Nuestra clave pública se puede subir a diferentes servidores o enviarla nosotros mismos, con un fichero armado por ejemple, si disponemos de un canal de confianza seguro ya que el receptor tiene que estar seguro de que la clave que recibe pertenece realmente a la persona correcta.</p>

<p>Una vez publicada la clave informaremos de ella haciendo referencia a su huella como estos chicos tan majos del <a href="https://puri.sm/about/team/">equipo de purism</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --send-keys 141839E8065C95F48E8DC329F87816F5B769CD83
gpg: enviando clave F87816F5B769CD83 a hkps://keys.openpgp.org
root@kali:~# </code></pre></div>
<p>Podemos usar otros servidores públicos como:</p>

<ul>
<li><p><a href="https://pgp.key-server.io/">public pgp-key server</a></p></li>

<li><p><a href="https://pgp.mit.edu/">mit public pgp-key server</a></p></li>

<li><p><a href="http://keyserver.ubuntu.com/">ubuntu keyserver</a></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --send-keys --keyserver https://pgp.key-server.io/ 141839E8065C95F48E8DC329F87816F5B769CD83
gpg: enviando clave F87816F5B769CD83 a https://pgp.key-server.io/
root@kali:~# </code></pre></div></li>
</ul>

<h2 id="consulta-de-nuestra-clave-publica">Consulta de nuestra clave publica</h2>

<p>Ahora otras personas que obtengan la huella de nuestra firma podrán buscar nuestra clave, pero no la podrán descargar porque no tiene un UID asociado.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">t@kali:~# gpg --search 141839E8065C95F48E8DC329F87816F5B769CD83
gpg: data source: https://keys.openpgp.org:443
<span class="o">(</span><span class="m">1</span><span class="o">)</span>       <span class="m">4096</span> bit RSA key F87816F5B769CD83
Keys <span class="m">1</span>-1 of <span class="m">1</span> <span class="k">for</span> <span class="s2">&#34;141839E8065C95F48E8DC329F87816F5B769CD83&#34;</span>.  Introduzca número<span class="o">(</span>s<span class="o">)</span>, O<span class="o">)</span>tro, o F<span class="o">)</span>in &gt; f
root@kali:~# </code></pre></div>
<h1 id="asociación-del-correo-electrónico-a-nuestra-clave">Asociación del correo electrónico a nuestra clave</h1>

<p>Asociar nuestra firma a nuestro correo electrónico lo hace el servidor de claves enviándonos un correo electrónico a la cuenta de correo que figura en la clave.</p>

<h2 id="búsqueda-de-clave-sin-uid">Búsqueda de clave sin UID</h2>

<p>Si realizamos una búsqueda de una clave (la nuestra en este caso), sin que el correo electrónico esté verificado, solo veremos la huella de la clave. Si una clave no tiene ningún UID asociado no se pude importar por otros usuarios.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --search 141839E8065C95F48E8DC329F87816F5B769CD83                                                                                            
gpg: data source: https://keys.openpgp.org:443                                                                                                                
<span class="o">(</span><span class="m">1</span><span class="o">)</span>       <span class="m">4096</span> bit RSA key F87816F5B769CD83                                                                                                                   
Keys <span class="m">1</span>-1 of <span class="m">1</span> <span class="k">for</span> <span class="s2">&#34;141839E8065C95F48E8DC329F87816F5B769CD83&#34;</span>.  Introduzca número<span class="o">(</span>s<span class="o">)</span>, O<span class="o">)</span>tro, o F<span class="o">)</span>in &gt; f    </code></pre></div>
<h2 id="verificación-del-correo-associado">Verificación del correo associado</h2>

<p>Correo recibido de openpgp.org</p>

<pre><code>Your key upload on keys.openpgp.org
keyserver@keys.openpgp.org 
 Hi,

this is an automated message from keys.openpgp.org. If you didn't upload your key there, please ignore this message.

OpenPGP key: 141839E8065C95F48E8DC329F87816F5B769CD83

This key was just uploaded for the first time, and is now published without identity information. If you want to allow others to find this key by e-mail address, please follow this link:
--- skipped ---
</code></pre>

<h2 id="búsqueda-de-clave-con-uid">Búsqueda de clave con UID</h2>

<p>Una vez que el servidor de claves nos haya verificado el correo electrónico lo asociará a la clave y podremos buscar la clave tambien por el correo electrónico asociado.
En entornos de firma digital, a parte de que las claves las crea una entidad certificadora, se identifica al usuario presencialmente y con documento de identidad para certificar que las claves se dan al sujeto identificado.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --search 141839E8065C95F48E8DC329F87816F5B769CD83
gpg: data source: https://keys.openpgp.org:443
<span class="o">(</span><span class="m">1</span><span class="o">)</span>     Viel Losero &lt;viel.losero@gmail.com&gt;
          <span class="m">4096</span> bit RSA key F87816F5B769CD83, creado: <span class="m">2019</span>-10-17
Keys <span class="m">1</span>-1 of <span class="m">1</span> <span class="k">for</span> <span class="s2">&#34;141839E8065C95F48E8DC329F87816F5B769CD83&#34;</span>.  Introduzca número<span class="o">(</span>s<span class="o">)</span>, O<span class="o">)</span>tro, o F<span class="o">)</span>in &gt; 
root@kali:~# 
root@kali:~# gpg --search viel.losero@gmail.com
gpg: data source: https://keys.openpgp.org:443
<span class="o">(</span><span class="m">1</span><span class="o">)</span>     Viel Losero &lt;viel.losero@gmail.com&gt;
          <span class="m">4096</span> bit RSA key F87816F5B769CD83, creado: <span class="m">2019</span>-10-17
Keys <span class="m">1</span>-1 of <span class="m">1</span> <span class="k">for</span> <span class="s2">&#34;viel.losero@gmail.com&#34;</span>.  Introduzca número<span class="o">(</span>s<span class="o">)</span>, O<span class="o">)</span>tro, o F<span class="o">)</span>in &gt;</code></pre></div>
<h1 id="trabajando-con-ficheros">Trabajando con ficheros</h1>

<p>Una vez creadas las clave podemos cifrar archivos propios para guardarlos de manera segura, descifrar archivos que nos hayan enviado terceros o firmar archivos, como veremos a continuación.</p>

<h2 id="cifrado-de-archivo">Cifrado de archivo</h2>

<p>La cifrado de archivos con cifrado asimétrico no es la función principal de dicho cifrado ya que para guardar archivos cifrados es una buena práctica hacelo con cifrado simétrico que es más rápido. Cuando ciframos un mensaje para nosotros mismos se usa nuestra clave pública, como si fuéramos un tercero, solo con nuestra clave privada podremos descifrarlo y leerlo.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# <span class="nb">echo</span> <span class="s2">&#34;mensaje de prueba&#34;</span> &gt; test.txt
root@kali:~# gpg --encrypt --sign --armor -r viel.losero@gmail.com test.txt

-- prompted <span class="k">for</span> passphrase

root@kali:~# cat test.txt.asc 
-----BEGIN PGP MESSAGE-----

hQIMAymOXBWhtoQCAQ/+NY9q6IU0NTaLAboT3l3q9CCrKgdLw8ayWiPY9MFNSTa3
4LTV3sYK1tHlmV8R4yBxPze72nSR0veBPbb5f+CKUbZAAyjbnDZnr9PpMrCsPgPm
--- skipped <span class="k">for</span> security reasons --- 
eM0sta/1VdsCO5yHm694EIgihp0Alpo/MVj0JxhxH0PSxnZs5i6kau1e9b/ViGDO
y5CY55rdnFCmQb+xJbjdjoqxlC/gySk1I5n2EB6rBe+pY5WBXk1E+tNxZtFHfwMV
<span class="nv">R9p5g9t19Vi7D0bT1M6Oj9a8gDs4g8t00R1kHpk1VEYDYZyJHnJkx9p74Qde</span>
<span class="o">=</span>AIh5
-----END PGP MESSAGE-----
root@kali:~# </code></pre></div>
<h2 id="descifrado-de-archivo">Descifrado de archivo</h2>

<p>La descifrado de archivos es una de las funciones principales del cifrado asimétrico. Terceras personas con nuestra clave pública, o nosotros mismos, podrán o podremos cifrar mensajes, estos mensajes solo se podrán descifrar y leer con nuestra clave privada.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --output test.txt.dec --decrypt test.txt.asc                                                                                                 
gpg: cifrado con clave de <span class="m">4096</span> bits RSA, ID 298E5C15A1B68402, creada el <span class="m">2019</span>-10-17                                                                            
      <span class="s2">&#34;Viel Losero &lt;viel.losero@gmail.com&gt;&#34;</span>                                                                                                                   
gpg: Firmado el jue <span class="m">17</span> oct <span class="m">2019</span> <span class="m">17</span>:50:32 CEST                                                                                                                 
gpg:                usando RSA clave 141839E8065C95F48E8DC329F87816F5B769CD83                                                                                 
gpg: Firma correcta de <span class="s2">&#34;Viel Losero &lt;viel.losero@gmail.com&gt;&#34;</span> <span class="o">[</span>absoluta<span class="o">]</span>                                                                                       
root@kali:~# ls -la test.txt*
-rw-r--r-- <span class="m">1</span> root root   <span class="m">18</span> oct <span class="m">17</span> <span class="m">17</span>:49 test.txt
-rw-r--r-- <span class="m">1</span> root root <span class="m">1686</span> oct <span class="m">17</span> <span class="m">17</span>:50 test.txt.asc
-rw-r--r-- <span class="m">1</span> root root   <span class="m">18</span> oct <span class="m">17</span> <span class="m">17</span>:51 test.txt.dec
root@kali:~# 
root@kali:~# cat test.txt.dec 
mensaje de prueba
root@kali:~# </code></pre></div>
<h2 id="firmado-de-archivo">Firmado de archivo</h2>

<p>El firmado de archivos también es una de las funciones principales del cifrado asimétrico. En entornos de firma digital, cuando las claves las crea una entidad certificadora y un usuario firma un documento, dan autenticidad integridad y no repudio al documento.</p>

<p>En nuestro caso, como veremos mas adelante cuando asociemos el correo electrónico a la clave publica, nuestra clave solo podrá acreditar que quien firma o descifrar archivos es el propietario de la cuenta de correo asociada.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --clear-sign  -o test.txt.clear test.txt
root@kali:~# ls -la test.txt*
-rw-r--r-- <span class="m">1</span> root root  <span class="m">18</span> oct <span class="m">17</span> <span class="m">18</span>:09 test.txt
-rw-r--r-- <span class="m">1</span> root root <span class="m">900</span> oct <span class="m">17</span> <span class="m">18</span>:10 test.txt.asc
-rw-r--r-- <span class="m">1</span> root root <span class="m">900</span> oct <span class="m">17</span> <span class="m">18</span>:13 test.txt.clear
-rw-r--r-- <span class="m">1</span> root root  <span class="m">18</span> oct <span class="m">17</span> <span class="m">17</span>:51 test.txt.dec
root@kali:~# </code></pre></div>
<h2 id="comprobación-de-firma">Comprobación de firma</h2>

<p>Verificar un mensaje firmado es relativamente simple. El mensaje viene en texto claro y con un simple <strong>cat</strong> podemos verlo.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --verify test.txt.clear 
gpg: Firmado el jue <span class="m">17</span> oct <span class="m">2019</span> <span class="m">18</span>:13:08 CEST
gpg:                usando RSA clave 141839E8065C95F48E8DC329F87816F5B769CD83
gpg: Firma correcta de <span class="s2">&#34;Viel Losero &lt;viel.losero@gmail.com&gt;&#34;</span> <span class="o">[</span>absoluta<span class="o">]</span>
root@kali:~# 
root@kali:~# cat test.txt.clear 
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

mensaje de prueba
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEFBg56AZclfSOjcMp+HgW9bdpzYMFAl2q6rEACgkQ+HgW9bdp
zYPnShAAlh9MX5EZHyXZ3oxLntIthfmJ7dTMnYzNxnaMT5FTvUKjyq0joXuoKnYx
--- skipped <span class="k">for</span> security reasons --- 
jbcm0Iz4Vb1WicAo2ARTYKfRXroSZQlqQVZONzbYBEtypEJ6qKmk82/FUifuhTXK
<span class="nv">mUfdrdAoRTBL6QDYHPfR3bjXYHcgwyEPxrruIsNhpHk8Uiqeoaw</span><span class="o">=</span>
<span class="o">=</span>mhz2
-----END PGP SIGNATURE-----</code></pre></div>
<h1 id="terceros">Terceros</h1>

<p>Enviar correos electrónicos cifrados a terceros de manera segura es relativamente fácil con GPG. En este apartado usaremos la clave publica del CEO de purism solo para realizar una prueba de cifrado pero no le enviaremos el archivo por correo electrónico.</p>

<h2 id="importación-de-claves-públicas-de-terceros">Importación de claves públicas de terceros</h2>

<p>Si una clave no tiene un UID asociado no podemos importarla correctamente, por suerte podemos consultar otros servidores para ver si disponen de la clave asociada a algún correo electrónico.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --search B8CAACEAD94930F123C4642C23CF2E3D254514F7
gpg: data source: https://keys.openpgp.org:443
<span class="o">(</span><span class="m">1</span><span class="o">)</span>       <span class="m">4096</span> bit RSA key 23CF2E3D254514F7
Keys <span class="m">1</span>-1 of <span class="m">1</span> <span class="k">for</span> <span class="s2">&#34;B8CAACEAD94930F123C4642C23CF2E3D254514F7&#34;</span>.  Introduzca número<span class="o">(</span>s<span class="o">)</span>, O<span class="o">)</span>tro, o F<span class="o">)</span>in &gt; f
root@kali:~# 
root@kali:~# gpg --recv-keys B8CAACEAD94930F123C4642C23CF2E3D254514F7
gpg: key 23CF2E3D254514F7: new key but contains no user ID - skipped
gpg: Cantidad total procesada: <span class="m">1</span>
gpg:           sin identificador: <span class="m">1</span>
root@kali:~# 
root@kali:~# gpg --search --keyserver hkps://keyserver.ubuntu.com  B8CAACEAD94930F123C4642C23CF2E3D254514F7 
gpg: data source: https://162.213.33.8:443
<span class="o">(</span><span class="m">1</span><span class="o">)</span>     Todd Weaver &lt;todd@puri.sm&gt;
        Todd Weaver &lt;ceo@puri.sm&gt;
          <span class="m">4096</span> bit RSA key 23CF2E3D254514F7, creado: <span class="m">2014</span>-12-05
Keys <span class="m">1</span>-1 of <span class="m">1</span> <span class="k">for</span> <span class="s2">&#34;B8CAACEAD94930F123C4642C23CF2E3D254514F7&#34;</span>.  Introduzca número<span class="o">(</span>s<span class="o">)</span>, O<span class="o">)</span>tro, o F<span class="o">)</span>in &gt; f
root@kali:~# 
root@kali:~# gpg --recv-keys --keyserver hkps://keyserver.ubuntu.com  B8CAACEAD94930F123C4642C23CF2E3D254514F7 
gpg: clave 23CF2E3D254514F7: clave pública <span class="s2">&#34;Todd Weaver &lt;todd@puri.sm&gt;&#34;</span> importada
gpg: Cantidad total procesada: <span class="m">1</span>
gpg:               importadas: <span class="m">1</span>
root@kali:~# </code></pre></div>
<h2 id="cifrado-de-mensaje-para-otra-persona">Cifrado de mensaje para otra persona</h2>

<p>Una vez tenemos la clave publica de la persona con la que queramos comunicarnos de manera segura, podemos cifrar un mensaje para dicha persona que solo podrá leer con su clave privada.</p>

<p>El mensaje de warning que sale es porque aun no hemos firmado (confiado) la clave publica del destinatario.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg -r B8CAACEAD94930F123C4642C23CF2E3D254514F7 --encrypt test.txt                                                                               
gpg: 7F609032678C8047: No hay seguridad de que esta clave pertenezca realmente                                                                                
al usuario que se nombra

sub  rsa4096/7F609032678C8047 <span class="m">2014</span>-12-05 Todd Weaver &lt;todd@puri.sm&gt;
 Huella clave primaria: B8CA ACEA D949 30F1 23C4  642C 23CF 2E3D <span class="m">2545</span> 14F7
      Huella de subclave: 4D32 522D BE68 B6B5 31B9  26A2 7F60 <span class="m">9032</span> 678C <span class="m">8047</span>

No es seguro que la clave pertenezca a la persona que se nombra en el
identificador de usuario. Si *realmente* sabe lo que está haciendo,
puede contestar sí a la siguiente pregunta.

¿Usar esta clave de todas formas? <span class="o">(</span>s/N<span class="o">)</span> s</code></pre></div>
<h3 id="testando-el-descifrado">Testando el descifrado</h3>

<p>Sin comentarios xd.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg test.txt.gpg 
gpg: ADVERTENCIA: no se ha proporcionado ninguna orden. Intentando adivinar lo que quieres...
gpg: cifrado con clave de <span class="m">4096</span> bits RSA, ID 7F609032678C8047, creada el <span class="m">2014</span>-12-05
      <span class="s2">&#34;Todd Weaver &lt;todd@puri.sm&gt;&#34;</span>
gpg: descifrado fallido: No secret key
root@kali:~# </code></pre></div>
<h2 id="firmando-claves-de-terceros">Firmando claves de terceros</h2>

<p>Cuando confiamos en que una clave publica pertenece realmente a la persona indicada podemos firmar esa clave para confiar el ella.
Podemos ver como antes de firmar la clave publica, en el listado de claves publicas sale como deconocida.</p>

<h3 id="listado-de-claves">Listado de claves</h3>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --list-keys                                                                                                                                  
/root/.gnupg/pubring.kbx                                                                                                                                      
------------------------                                                                                                                                      
pub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>SC<span class="o">]</span>                                                                                                                                 
      141839E8065C95F48E8DC329F87816F5B769CD83                                                                                                                
uid        <span class="o">[</span>  absoluta <span class="o">]</span> Viel Losero &lt;viel.losero@gmail.com&gt;                                                                                                  
sub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>E<span class="o">]</span>                                                                                                                                  
                                                                                                                                                              
pub   rsa4096 <span class="m">2014</span>-12-05 <span class="o">[</span>SC<span class="o">]</span>                                                                                                                                 
      B8CAACEAD94930F123C4642C23CF2E3D254514F7                                                                                                                
uid        <span class="o">[</span>desconocida<span class="o">]</span> Todd Weaver &lt;todd@puri.sm&gt;                                                                                                           
uid        <span class="o">[</span>desconocida<span class="o">]</span> Todd Weaver &lt;ceo@puri.sm&gt;                                                                                                            
uid        <span class="o">[</span>desconocida<span class="o">]</span> <span class="o">[</span>jpeg image of size <span class="m">3931</span><span class="o">]</span>                                                                                                            
sub   rsa4096 <span class="m">2014</span>-12-05 <span class="o">[</span>E<span class="o">]</span>                                                                                                                                  </code></pre></div>
<h3 id="firmado-de-la-clave-pública-de-otra-persona">Firmado de la clave pública de otra persona</h3>

<p>Tenenos que estar seguros que la huella de la clave es correcta y pertenece a la persona indicada. Una vez estemos seguros podemos firmar su clave pública para confiar en ella y que no nos de avisos al respecto.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --sign-key B8CAACEAD94930F123C4642C23CF2E3D254514F7                                                                                          
                                                                                                                                                              
pub  rsa4096/23CF2E3D254514F7                                                                                                                                 
     creado: <span class="m">2014</span>-12-05  caduca: nunca       uso: SC                                                                                                          
     confianza: desconocido   validez: desconocido                                                                                                            
sub  rsa4096/7F609032678C8047                                                                                                                                 
     creado: <span class="m">2014</span>-12-05  caduca: nunca       uso: E                                                                                                           
<span class="o">[</span>desconocida<span class="o">]</span> <span class="o">(</span><span class="m">1</span><span class="o">)</span>. Todd Weaver &lt;todd@puri.sm&gt;                                                                                                                 
<span class="o">[</span>desconocida<span class="o">]</span> <span class="o">(</span><span class="m">2</span><span class="o">)</span>  Todd Weaver &lt;ceo@puri.sm&gt;                                                                                                                  
<span class="o">[</span>desconocida<span class="o">]</span> <span class="o">(</span><span class="m">3</span><span class="o">)</span>  <span class="o">[</span>jpeg image of size <span class="m">3931</span><span class="o">]</span>

¿Firmar realmente todos los IDs de usuario? <span class="o">(</span>s/N<span class="o">)</span> s

pub  rsa4096/23CF2E3D254514F7
     creado: <span class="m">2014</span>-12-05  caduca: nunca       uso: SC  
     confianza: desconocido   validez: desconocido
 Huella clave primaria: B8CA ACEA D949 30F1 23C4  642C 23CF 2E3D <span class="m">2545</span> 14F7

     Todd Weaver &lt;todd@puri.sm&gt;
     Todd Weaver &lt;ceo@puri.sm&gt;
     <span class="o">[</span>jpeg image of size <span class="m">3931</span><span class="o">]</span>

¿Está realmente seguro de querer firmar esta clave
con su clave: <span class="s2">&#34;Viel Losero &lt;viel.losero@gmail.com&gt;&#34;</span> <span class="o">(</span>F87816F5B769CD83<span class="o">)</span>?

¿Firmar de verdad? <span class="o">(</span>s/N<span class="o">)</span> s</code></pre></div>
<h3 id="confianza-en-claves-públicas-de-terceros">Confianza en claves públicas de terceros</h3>

<p>Podemos ver como una vez firmada la clave publica de otra persona y añadida a nuestro anillo se lista con confianza total.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --list-keys
gpg: comprobando base de datos de confianza
gpg: marginals needed: <span class="m">3</span>  completes needed: <span class="m">1</span>  trust model: pgp
gpg: nivel: <span class="m">0</span>  validez:   <span class="m">1</span>  firmada:   <span class="m">1</span>  confianza: <span class="m">0</span>-, 0q, 0n, 0m, 0f, 1u
gpg: nivel: <span class="m">1</span>  validez:   <span class="m">1</span>  firmada:   <span class="m">0</span>  confianza: <span class="m">1</span>-, 0q, 0n, 0m, 0f, 0u
/root/.gnupg/pubring.kbx
------------------------
pub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>SC<span class="o">]</span>
      141839E8065C95F48E8DC329F87816F5B769CD83
uid        <span class="o">[</span>  absoluta <span class="o">]</span> Viel Losero &lt;viel.losero@gmail.com&gt;
sub   rsa4096 <span class="m">2019</span>-10-17 <span class="o">[</span>E<span class="o">]</span>

pub   rsa4096 <span class="m">2014</span>-12-05 <span class="o">[</span>SC<span class="o">]</span>
      B8CAACEAD94930F123C4642C23CF2E3D254514F7
uid        <span class="o">[</span>   total   <span class="o">]</span> Todd Weaver &lt;todd@puri.sm&gt;
uid        <span class="o">[</span>   total   <span class="o">]</span> Todd Weaver &lt;ceo@puri.sm&gt;
uid        <span class="o">[</span>   total   <span class="o">]</span> <span class="o">[</span>jpeg image of size <span class="m">3931</span><span class="o">]</span>
sub   rsa4096 <span class="m">2014</span>-12-05 <span class="o">[</span>E<span class="o">]</span>

root@kali:~# </code></pre></div>
<h3 id="firmado-y-cifrado-de-mensaje-usando-el-uid-del-correo">Firmado y cifrado de mensaje usando el UID del correo</h3>

<p>Para trabajar mas cómodamente y no tener que estar copiando huellas de claves podemos cifrar mensajes usando cualquier UID de la clave.</p>

<p>También podemos firmar el mensaje que queremos enviar a la persona par que sepa que proviene de nosotros y no de otra persona.</p>

<p>IMPORTANTE!! Antes de enviar un mensaje o al recibirlo, tenemos que verificar que la clave del tercero no esté revocada.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg  -r ceo@puri.sm -u viel@losero@gmail.com --encrypt test.txt                                                                                  
El fichero <span class="s1">&#39;test.txt.gpg&#39;</span> ya existe. ¿Sobreescribir? <span class="o">(</span>s/N<span class="o">)</span> s                                                                                                  
root@kali:~# ls -la test.txt*                                                                                                                                 
-rw-r--r-- <span class="m">1</span> root root  <span class="m">18</span> oct <span class="m">17</span> <span class="m">18</span>:09 test.txt                                                                                                              
-rw-r--r-- <span class="m">1</span> root root <span class="m">900</span> oct <span class="m">17</span> <span class="m">18</span>:10 test.txt.asc                                                                                                          
-rw-r--r-- <span class="m">1</span> root root <span class="m">900</span> oct <span class="m">19</span> <span class="m">12</span>:51 test.txt.clear                                                                                                        
-rw-r--r-- <span class="m">1</span> root root  <span class="m">18</span> oct <span class="m">17</span> <span class="m">17</span>:51 test.txt.dec                                                                                                          
-rw-r--r-- <span class="m">1</span> root root <span class="m">566</span> oct <span class="m">17</span> <span class="m">18</span>:16 test.txt.dtc                                                                                                          
-rw-r--r-- <span class="m">1</span> root root <span class="m">614</span> oct <span class="m">19</span> <span class="m">19</span>:05 test.txt.gpg    
root@kali:~# </code></pre></div>
<h1 id="administración-de-claves">Administración de claves</h1>

<p>Una de las partes mas importantes de gpg es la gestión de nuestras claves privadas, los certificados de revocación y la actualización del anillo de claves.</p>

<h2 id="actualización-y-comprobación-de-claves-de-terceros">Actualización y comprobación de claves de terceros</h2>

<p>Antes de enviar un mensaje o comprobar la validez de la firma de un tercero es bueno actualizar regularmente nuestro anillo de claves, añadiéndolo al CRON o manualmente, para poder consultar posibles certificados revocados.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --refresh-keys
gpg: renovando <span class="m">2</span> claves desde hkps://keys.openpgp.org
gpg: clave 23CF2E3D254514F7: <span class="s2">&#34;Todd Weaver &lt;todd@puri.sm&gt;&#34;</span> sin cambios
gpg: clave F87816F5B769CD83: <span class="s2">&#34;Viel Losero &lt;viel.losero@gmail.com&gt;&#34;</span> sin cambios
gpg: Cantidad total procesada: <span class="m">2</span>
gpg:              sin cambios: <span class="m">2</span>
root@kali:~# </code></pre></div>
<h2 id="creación-del-fichero-de-revocación">Creación del fichero de revocación</h2>

<p>Las buenas practicas sugieren almacenar el certificado de revocación de la clave pública y una copia de seguridad de la clave privada en un dispositivo USB o medio externo protegido contra escritura y en un lugar seguro. Si nuestro certificado es comprometido o lo perdemos, podremos revocar el mismo desde un tercer dispositivo.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~# gpg --output viel.losero@gmail.com-revocation.crt --gen-revoke viel.losero@gmail.com

sec  rsa4096/F87816F5B769CD83 <span class="m">2019</span>-10-17 Viel Losero &lt;viel.losero@gmail.com&gt;

¿Crear un certificado de revocación para esta clave? <span class="o">(</span>s/N<span class="o">)</span> s
Por favor elija una razón para la revocación:
  <span class="nv">0</span> <span class="o">=</span> No se dio ninguna razón
  <span class="nv">1</span> <span class="o">=</span> La clave ha sido comprometida
  <span class="nv">2</span> <span class="o">=</span> La clave ha sido reemplazada
  <span class="nv">3</span> <span class="o">=</span> La clave ya no está en uso
  <span class="nv">Q</span> <span class="o">=</span> Cancelar
<span class="o">(</span>Probablemente quería seleccionar <span class="m">1</span> aquí<span class="o">)</span>
¿Su decisión? <span class="m">0</span>
Introduzca una descripción opcional<span class="p">;</span> acábela con una línea vacía:
&gt; Initial Rebocation Backup
&gt; 
Razón para la revocación: No se dio ninguna razón
Initial Rebocation Backup
¿Es correcto? <span class="o">(</span>s/N<span class="o">)</span> s
se fuerza salida con armadura ASCII.
Certificado de revocación creado.

Por favor consérvelo en un medio que pueda esconder<span class="p">;</span> si alguien consigue
acceso a este certificado puede usarlo para inutilizar su clave.
Es inteligente imprimir este certificado y guardarlo en otro lugar, por
si acaso su medio resulta imposible de leer. Pero precaución: ¡el sistema
de impresión de su máquina podría almacenar los datos y hacerlos accesibles
a otras personas!
root@kali:~# </code></pre></div>
<h2 id="cifrado-del-certificado-de-revocación">Cifrado del certificado de revocación</h2>

<p>Usaremos el propio gpg pero con cifrado simétrico para cifrar el certificado de revocación.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~/data/.gnupg# gpg -c viel.losero@gmail.com-revocation.crt                                                                                          
root@kali:~/data/.gnupg# ls -la                                                                                                                               
total <span class="m">28</span>                                                                                                                                                      
drwx------  <span class="m">4</span> root root  <span class="m">249</span> oct <span class="m">19</span> <span class="m">19</span>:49 .                                                                                                                   
drwxr-xr-x <span class="m">29</span> root root <span class="m">4096</span> oct <span class="m">17</span> <span class="m">16</span>:21 ..                                                                                                                  
drwx------  <span class="m">2</span> root root   <span class="m">58</span> oct <span class="m">17</span> <span class="m">16</span>:21 openpgp-revocs.d                                                                                                    
drwx------  <span class="m">2</span> root root  <span class="m">110</span> oct <span class="m">17</span> <span class="m">16</span>:21 private-keys-v1.d                                                                                                   
-rw-r--r--  <span class="m">1</span> root root <span class="m">2477</span> oct <span class="m">17</span> <span class="m">16</span>:21 pubring.kbx                                                                                                         
-rw-------  <span class="m">1</span> root root   <span class="m">32</span> oct <span class="m">17</span> <span class="m">16</span>:21 pubring.kbx~                                                                                                        
-rw-------  <span class="m">1</span> root root <span class="m">1280</span> oct <span class="m">17</span> <span class="m">16</span>:21 trustdb.gpg                                                                                                         
-rw-r--r--  <span class="m">1</span> root root <span class="m">3134</span> oct <span class="m">17</span> <span class="m">16</span>:27 viel.losero@gmail.com-public-key.gpg                                                                                
-rw-------  <span class="m">1</span> root root  <span class="m">926</span> oct <span class="m">19</span> <span class="m">19</span>:39 viel.losero@gmail.com-revocation.crt                                                                                
-rw-r--r--  <span class="m">1</span> root root  <span class="m">829</span> oct <span class="m">19</span> <span class="m">19</span>:49 viel.losero@gmail.com-revocation.crt.gpg  </code></pre></div>
<p>Borrado del fichero de revocación con <a href="https://linux.die.net/man/1/wipe">wipe</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~/data/.gnupg# wipe viel.losero@gmail.com-revocation.crt
Okay to WIPE <span class="m">1</span> regular file ? <span class="o">(</span>Yes/No<span class="o">)</span> yes
Wiping viel.losero@gmail.com-revocation, pass <span class="m">34</span> <span class="o">(</span><span class="m">34</span><span class="o">)</span>   
Operation finished.                                                           
<span class="m">1</span> file wiped and <span class="m">0</span> special files ignored in <span class="m">0</span> directories, <span class="m">0</span> symlinks removed but not followed, <span class="m">0</span> errors occurred.
root@kali:~/data/.gnupg# </code></pre></div>
<p>Cambio de los permisos a solo lectura</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">root@kali:~/data/.gnupg# chmod <span class="m">400</span> viel.losero@gmail.com-revocation.crt.gpg 
root@kali:~/data/.gnupg# ls -la
total <span class="m">24</span>
drwx------  <span class="m">4</span> root root  <span class="m">205</span> oct <span class="m">19</span> <span class="m">19</span>:51 .
drwxr-xr-x <span class="m">29</span> root root <span class="m">4096</span> oct <span class="m">17</span> <span class="m">16</span>:21 ..
drwx------  <span class="m">2</span> root root   <span class="m">58</span> oct <span class="m">17</span> <span class="m">16</span>:21 openpgp-revocs.d
drwx------  <span class="m">2</span> root root  <span class="m">110</span> oct <span class="m">17</span> <span class="m">16</span>:21 private-keys-v1.d
-rw-r--r--  <span class="m">1</span> root root <span class="m">2477</span> oct <span class="m">17</span> <span class="m">16</span>:21 pubring.kbx
-rw-------  <span class="m">1</span> root root   <span class="m">32</span> oct <span class="m">17</span> <span class="m">16</span>:21 pubring.kbx~
-rw-------  <span class="m">1</span> root root <span class="m">1280</span> oct <span class="m">17</span> <span class="m">16</span>:21 trustdb.gpg
-rw-r--r--  <span class="m">1</span> root root <span class="m">3134</span> oct <span class="m">17</span> <span class="m">16</span>:27 viel.losero@gmail.com-public-key.gpg
-r--------  <span class="m">1</span> root root  <span class="m">829</span> oct <span class="m">19</span> <span class="m">19</span>:49 viel.losero@gmail.com-revocation.crt.gpg
root@kali:~/data/.gnupg# </code></pre></div>
<p>Ahora solo queda hacer la copia en un dispositivo externo.</p>

<p><a href="#" class="back">back</a></p>

<p>Referencias:</p>

<p><a href="https://es.wikipedia.org/wiki/GNU_Privacy_Guard">GNU_Privacy_Guard</a></p>

<p><a href="https://www.gnupg.org/gph/en/manual.html">Manual gnupg.org</a></p>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-use-gpg-to-encrypt-and-sign-messages">How to use GPG </a></p>

<p><a href="https://puri.sm/about/team/">Purism Core Team</a></p>

<p>Licencia: <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA</a></p>

	 </article>
    </article>
</main>

		</div>
	</section><footer>
	Send your coments here --> 
	<a href="https://twitter.com/VLosero">[Twitter]</a>
	<a href="https://github.com/VielLosero">[Git]</a>
	<a href="mailto:viel.losero@gmail.com">[Email]</a>
	&lt;-- Envia tus comentarios aquí
	<p class=post-meta >PGP: 1418 39E8 065C 95F4 8E8D  C329 F878 16F5 B769 CD83</p>
	<div style="font-size:16px;margin:0 auto;width:300px" class="blockchain-btn"
     data-address="1LMJZcpJiHkiYiHrqUZdmbHJyUvF5KUsdq"
     data-shared="false">
	    <div class="blockchain stage-begin">
	        <img src="https://blockchain.info/Resources/buttons/donate_64.png"/>
	    </div>
	    <div class="blockchain stage-loading" style="text-align:center">
	        <img src="https://blockchain.info/Resources/loading-large.gif"/>
	    </div>
	    <div class="blockchain stage-ready">
	         <p align="center">Please Donate To Bitcoin Address: <b>[[address]]</b></p>
	         <p align="center" class="qr-code"></p>
	    </div>
	    <div class="blockchain stage-paid">
	         Donation of <b>[[value]] BTC</b> Received. Thank You.
	    </div>
	    <div class="blockchain stage-error">
	        <font color="red">[[error]]</font>
	    </div>
	   </div>
	<p>Copyright © 2019 Viel Losero</p>
	<p>Powered by <a href="https://gohugo.io/">Hugo</a></p>
</footer>
</body>
</html>
